{{ $_title := .Title }}
{{ $_id := replace (urlize $_title | lower) " " "-" }}
{{ $label := "" }}
{{ if eq .Params.type "calculation" }}
  {{ $label = "calculators" }}
{{ end }}
{{ if eq .Params.type "measurement" }}
  {{ $label = "measurements" }}
{{ end }}
<div class="col-md-12 col-lg-6">
  <section class="card mb-4">
    <div class="guide-thumbnail">
      {{ if isset .Params  "thumbnail_image" }}
      <div class="guide-thumbnail-image d-flex justify-content-center align-items-center" style="background-image:url({{ .Params.thumbnail_image | absURL }});">
      {{ else }}
        <!-- If guide doesn't have featured image -->
      <div class="guide-thumbnail-image d-flex justify-content-center align-items-center" style="background-image:url(/images/hero/electric-plant-icon-logo-gray.png);">
      {{ end }}
      </div>
      <div class="guide-thumbnail-content">
        <div class="px-4 d-flex flex-column justify-content-between" style="height: 65%;">
          <div>
            <h5>{{ .Title }}</h5>
            {{ partial "thumbnail/excerpt.html" .Params.excerpt }}
          </div>
          <div>
            <a class="btn btn-primary" href="{{ .RelPermalink | relURL }}">View {{ .Params.type | safeHTML | title }}</a>
          </div>
        </div>
        <hr class="my-3">
        <div class="px-4">
          <p class="">Associated {{ $label }}:</p>
          <ul id="list-related-{{ $_id }}" class="mt-n3 mb-0">
            {{ if isset .Params "associated_measurement_techniques" }}
              {{ range first 3 (where .Site.RegularPages "Title" "in" .Params.associated_measurement_techniques) }}
                {{ partial "thumbnail/associated_systems.html" .  }}
              {{ end }}
              {{ partial "thumbnail/see_more_associated_measurement.html" (dict "id" $_id "type" .Params.type "content" .Params.associated_measurement_techniques "all_pages" .Site.RegularPages "guide_title" $_title) }}
            {{ end }}

            {{ if isset .Params "associated_calculators" }}
              {{ $calculators := where .Site.Data.downloadable_files.files "name" "in" .Params.associated_calculators }}
              {{ range first 3 $calculators }}
                {{ partial "thumbnail/associated_calculators.html" .  }}
              {{ end }}
              {{ partial "thumbnail/see_more_associated_calculators.html" (dict "id" $_id "type" .Params.type "content" .Params.associated_calculators "all_calculators" $calculators "guide_title" $_title) }}
            {{ end }}
            
          </ul>
        </div>
      </div>
    </div>
  </section>
</div>